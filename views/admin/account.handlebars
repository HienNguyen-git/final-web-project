<div class="admin-section admin-section2">
  <div class="admin-section-panel admin-section-panel4">
    <div class="admin-panel-section-header">
      <h2>List Account</h2>

      <select name="type" id="account-type" style="margin-left: 1rem; padding: 10px">
        <option value="0" selected>Waiting for verification</option>
        <option value="1">Complete</option>
        <option value="2">Disable</option>
        <option value="3">Pending</option>
        <option value="4">Block</option>
      </select>
    </div>
    <table cellpadding="10" cellspacing="10" border="1" style="width: 100%">
      <tr class="header">
        <td>ID</td>
        <td>Username</td>
        <td>Last modified</td>
      </tr>
      <tbody id="tbody" class="p-3">
        {{#each data}}
          <tr class="item">
            <td>{{id}}</td>
            <td><a href="account?username={{username}}">{{username}}</a></td>
            <td>{{last_modified}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>
<script>

  const accountStatus = document.getElementById('account-type');
  const myTbody = document.getElementById('tbody')
  if(accountStatus&&myTbody){
    accountStatus.addEventListener('change',async (e)=>{
      
      try{
        const myURL = location.href+"/api?status="+e.target.value
        console.log(myURL)
        const fetchURL = await fetch(myURL)
        const res = await fetchURL.json()
        if(res.code){
          throw new Error(res.message)
        }
        const data = res.data
        let context = data.map(e=>`
            <tr class="item">
              <td>${e.id}</td>
              <td><a href="account?username=${e.username}">${e.username}</a></td>
              <td>${e.last_modified}</td>
            </tr>
        `).join("")
        console.log(data.length)
        if(!data.length){
          context = `
          <td colspan="4" class="text-center">Data is empty</td>
          `
        }
        myTbody.innerHTML = ""
        myTbody.insertAdjacentHTML('beforeend', context)
      }catch(err){
        console.error(err.message)
      }
      
    })
  }

</script>